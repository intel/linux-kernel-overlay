From 27d362dac5031c8bf69c335d104f6c86076d9fe1 Mon Sep 17 00:00:00 2001
From: "David E. Box" <david.e.box@linux.intel.com>
Date: Fri, 12 Mar 2021 11:05:40 -0800
Subject: [PATCH 14/16] ACPI: sysfs: Add missing ACPI_LV_EVALUATION for ASL
 method tracing

ACPICA has for a long time provided a debug feature will display the ASL
method call trace to the kernel log. This is available by setting the
PARSER, NAMESPACE, and DISPATCHER flags in debug_layer and by setting the
previously undocumented LV_EVALUATION flag in debug_level. Add
LV_EVALUATION to the list of flags available under the debug_level
parameter. Also add documentation on how to enable ASL method trace.

Signed-off-by: David E. Box <david.e.box@linux.intel.com>
---
 Documentation/firmware-guide/acpi/debug.rst | 8 ++++++++
 drivers/acpi/sysfs.c                        | 1 +
 2 files changed, 9 insertions(+)

diff --git a/Documentation/firmware-guide/acpi/debug.rst b/Documentation/firmware-guide/acpi/debug.rst
index 0639c9de07f9..0428ca1eff29 100644
--- a/Documentation/firmware-guide/acpi/debug.rst
+++ b/Documentation/firmware-guide/acpi/debug.rst
@@ -88,6 +88,7 @@ currently these::
     ACPI_LV_RESOURCES               0x00010000
     ACPI_LV_USER_REQUESTS           0x00020000
     ACPI_LV_PACKAGE                 0x00040000
+    ACPI_LV_EVALUATION              0x00080000
     ACPI_LV_ALLOCATIONS             0x00100000
     ACPI_LV_FUNCTIONS               0x00200000
     ACPI_LV_OPTIMIZATIONS           0x00400000
@@ -130,3 +131,10 @@ Enable all ACPI_DB_INFO messages after boot::
 Show all valid component values::
 
     # cat /sys/module/acpi/parameters/debug_layer
+
+For ASL method trace, ACPI_NAMESPACE, ACPI_PARSER, and ACPI_DISPATCHER in
+debug_layer and ACPI_LV_EVALUATION in acpi.debug_level. Note that this may
+produce a ton of trace in dmesg::
+
+    # echo 0x70 > /sys/module/acpi/parameters/debug_layer
+    # echo 0x80000 > /sys/module/acpi/parameters/debug_level
diff --git a/drivers/acpi/sysfs.c b/drivers/acpi/sysfs.c
index d25927195d6d..adeb5f7b5d63 100644
--- a/drivers/acpi/sysfs.c
+++ b/drivers/acpi/sysfs.c
@@ -71,6 +71,7 @@ static const struct acpi_dlevel acpi_debug_levels[] = {
 	ACPI_DEBUG_INIT(ACPI_LV_RESOURCES),
 	ACPI_DEBUG_INIT(ACPI_LV_USER_REQUESTS),
 	ACPI_DEBUG_INIT(ACPI_LV_PACKAGE),
+	ACPI_DEBUG_INIT(ACPI_LV_EVALUATION),
 
 	ACPI_DEBUG_INIT(ACPI_LV_ALLOCATIONS),
 	ACPI_DEBUG_INIT(ACPI_LV_FUNCTIONS),
-- 
2.27.0

