From 5d98ff3ff7dbcf57f309f6a69a77d20932c2c856 Mon Sep 17 00:00:00 2001
From: Ranjan Dutta <ranjan.dutta@intel.com>
Date: Sat, 13 Feb 2021 16:02:07 +0800
Subject: [PATCH 15/19] Revert "drivers/nouveau/kms/nv50-: Reject format
 modifiers for cursor planes"

This reverts commit cc11bd18d4a31abd419f502aded67da1c73e2678.
---
 drivers/gpu/drm/nouveau/dispnv50/wndw.c | 17 ++++-------------
 1 file changed, 4 insertions(+), 13 deletions(-)

diff --git a/drivers/gpu/drm/nouveau/dispnv50/wndw.c b/drivers/gpu/drm/nouveau/dispnv50/wndw.c
index f07916ffe42c..0356474ad6f6 100644
--- a/drivers/gpu/drm/nouveau/dispnv50/wndw.c
+++ b/drivers/gpu/drm/nouveau/dispnv50/wndw.c
@@ -702,11 +702,6 @@ nv50_wndw_init(struct nv50_wndw *wndw)
 	nvif_notify_get(&wndw->notify);
 }
 
-static const u64 nv50_cursor_format_modifiers[] = {
-	DRM_FORMAT_MOD_LINEAR,
-	DRM_FORMAT_MOD_INVALID,
-};
-
 int
 nv50_wndw_new_(const struct nv50_wndw_func *func, struct drm_device *dev,
 	       enum drm_plane_type type, const char *name, int index,
@@ -718,7 +713,6 @@ nv50_wndw_new_(const struct nv50_wndw_func *func, struct drm_device *dev,
 	struct nvif_mmu *mmu = &drm->client.mmu;
 	struct nv50_disp *disp = nv50_disp(dev);
 	struct nv50_wndw *wndw;
-	const u64 *format_modifiers;
 	int nformat;
 	int ret;
 
@@ -734,13 +728,10 @@ nv50_wndw_new_(const struct nv50_wndw_func *func, struct drm_device *dev,
 
 	for (nformat = 0; format[nformat]; nformat++);
 
-	if (type == DRM_PLANE_TYPE_CURSOR)
-		format_modifiers = nv50_cursor_format_modifiers;
-	else
-		format_modifiers = nouveau_display(dev)->format_modifiers;
-
-	ret = drm_universal_plane_init(dev, &wndw->plane, heads, &nv50_wndw, format, nformat,
-				       format_modifiers, type, "%s-%d", name, index);
+	ret = drm_universal_plane_init(dev, &wndw->plane, heads, &nv50_wndw,
+				       format, nformat,
+				       nouveau_display(dev)->format_modifiers,
+				       type, "%s-%d", name, index);
 	if (ret) {
 		kfree(*pwndw);
 		*pwndw = NULL;
-- 
2.25.1

