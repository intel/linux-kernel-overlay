From d15ec52ca973883d82ee3452a058972330802c65 Mon Sep 17 00:00:00 2001
From: Ranjan Dutta <ranjan.dutta@intel.com>
Date: Tue, 6 Jul 2021 18:16:13 +0800
Subject: [PATCH 20/45] Revert "drm/msm/a6xx: avoid shadow NULL reference in
 failure path"

This reverts commit fd681a8c7ac8f649a0718f6cbf2fe75d0587c9a2.
---
 drivers/gpu/drm/msm/adreno/a6xx_gpu.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/gpu/drm/msm/adreno/a6xx_gpu.c b/drivers/gpu/drm/msm/adreno/a6xx_gpu.c
index 2dcbe02846cd9..935f1a4e86550 100644
--- a/drivers/gpu/drm/msm/adreno/a6xx_gpu.c
+++ b/drivers/gpu/drm/msm/adreno/a6xx_gpu.c
@@ -1128,7 +1128,7 @@ static int a6xx_pm_suspend(struct msm_gpu *gpu)
 	if (ret)
 		return ret;
 
-	if (a6xx_gpu->shadow_bo)
+	if (adreno_gpu->base.hw_apriv || a6xx_gpu->has_whereami)
 		for (i = 0; i < gpu->nr_rings; i++)
 			a6xx_gpu->shadow[i] = 0;
 
-- 
2.25.1

