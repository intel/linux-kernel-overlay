From 026711c69bc8eb9a2447cfe1fe711fc5fc3899ac Mon Sep 17 00:00:00 2001
From: Ranjan Dutta <ranjan.dutta@intel.com>
Date: Thu, 7 Jan 2021 11:21:02 +0800
Subject: [PATCH 27/42] Revert "drm/msm/a5xx: Clear shadow on suspend"

This reverts commit 66bb2a8a601111a9adc0b44e730291a52350c250.
---
 drivers/gpu/drm/msm/adreno/a5xx_gpu.c | 12 +-----------
 1 file changed, 1 insertion(+), 11 deletions(-)

diff --git a/drivers/gpu/drm/msm/adreno/a5xx_gpu.c b/drivers/gpu/drm/msm/adreno/a5xx_gpu.c
index 8aa08976aad1..d6804a802355 100644
--- a/drivers/gpu/drm/msm/adreno/a5xx_gpu.c
+++ b/drivers/gpu/drm/msm/adreno/a5xx_gpu.c
@@ -1207,9 +1207,7 @@ static int a5xx_pm_resume(struct msm_gpu *gpu)
 static int a5xx_pm_suspend(struct msm_gpu *gpu)
 {
 	struct adreno_gpu *adreno_gpu = to_adreno_gpu(gpu);
-	struct a5xx_gpu *a5xx_gpu = to_a5xx_gpu(adreno_gpu);
 	u32 mask = 0xf;
-	int i, ret;
 
 	/* A510 has 3 XIN ports in VBIF */
 	if (adreno_is_a510(adreno_gpu))
@@ -1229,15 +1227,7 @@ static int a5xx_pm_suspend(struct msm_gpu *gpu)
 	gpu_write(gpu, REG_A5XX_RBBM_BLOCK_SW_RESET_CMD, 0x003C0000);
 	gpu_write(gpu, REG_A5XX_RBBM_BLOCK_SW_RESET_CMD, 0x00000000);
 
-	ret = msm_gpu_pm_suspend(gpu);
-	if (ret)
-		return ret;
-
-	if (a5xx_gpu->has_whereami)
-		for (i = 0; i < gpu->nr_rings; i++)
-			a5xx_gpu->shadow[i] = 0;
-
-	return 0;
+	return msm_gpu_pm_suspend(gpu);
 }
 
 static int a5xx_get_timestamp(struct msm_gpu *gpu, uint64_t *value)
-- 
2.25.1

