From b46fb3b5dc9c1ae1fc3427205e7c36491078b970 Mon Sep 17 00:00:00 2001
From: "Pan, Kris" <kris.pan@intel.com>
Date: Tue, 9 Mar 2021 14:53:39 +0800
Subject: [PATCH 167/170] misc: xlink-ipc: don't set xlink_dev to NULL if
 sw_device_id match

Signed-off-by: Pan, Kris <kris.pan@intel.com>
---
 drivers/misc/xlink-ipc/xlink-ipc.c | 14 ++++++++------
 1 file changed, 8 insertions(+), 6 deletions(-)

diff --git a/drivers/misc/xlink-ipc/xlink-ipc.c b/drivers/misc/xlink-ipc/xlink-ipc.c
index 8ebd6ca57a40..7d7cf731e10c 100644
--- a/drivers/misc/xlink-ipc/xlink-ipc.c
+++ b/drivers/misc/xlink-ipc/xlink-ipc.c
@@ -1185,11 +1185,11 @@ static struct xlink_ipc_dev *get_xlink_dev_by_sw_device_id(u32 sw_device_id)
 		pdev = to_platform_device(dev);
 		xlink_dev = platform_get_drvdata(pdev);
 		ipc_id = GET_VPU_ID_FROM_SW_DEVICE_ID(sw_device_id);
-		if (GET_VPU_ID_FROM_SW_DEVICE_ID(xlink_dev->sw_device_id) == ipc_id)
+		if (GET_VPU_ID_FROM_SW_DEVICE_ID(xlink_dev->sw_device_id) == ipc_id) {
 			break;
-
-		xlink_dev = NULL;
-
+		} else {
+			xlink_dev = NULL;
+		}
 	}
 	return xlink_dev;
 }
@@ -1235,9 +1235,11 @@ static struct xlink_ipc_dev *get_xlink_dev_by_vpu_id(u32 id)
 			dev))) {
 		pdev = to_platform_device(dev);
 		xlink_dev = platform_get_drvdata(pdev);
-		if (xlink_dev->vpu_id == id)
+		if (xlink_dev->vpu_id == id) {
 			break;
-		xlink_dev = NULL;
+		} else {
+			xlink_dev = NULL;
+		}
 	}
 	return xlink_dev;
 }
-- 
2.27.0

