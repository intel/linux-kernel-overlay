From fede84cd4ef237f533b508d9721cf974296a40ec Mon Sep 17 00:00:00 2001
From: Ranjan Dutta <ranjan.dutta@intel.com>
Date: Thu, 7 Jan 2021 11:20:56 +0800
Subject: [PATCH 08/42] Revert "drm/amdgpu: fix regression in vbios reservation
 handling on headless"

This reverts commit c51e3679ebb532ad05483738ead6eb0a59c985a0.
---
 drivers/gpu/drm/amd/amdgpu/amdgpu_gmc.c | 9 ++++-----
 1 file changed, 4 insertions(+), 5 deletions(-)

diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu_gmc.c b/drivers/gpu/drm/amd/amdgpu/amdgpu_gmc.c
index ff4e22673930..3e4892b7b7d3 100644
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_gmc.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_gmc.c
@@ -494,14 +494,13 @@ void amdgpu_gmc_get_vbios_allocations(struct amdgpu_device *adev)
 		break;
 	}
 
-	if (!amdgpu_device_ip_get_ip_block(adev, AMD_IP_BLOCK_TYPE_DCE)) {
+	if (!amdgpu_device_ip_get_ip_block(adev, AMD_IP_BLOCK_TYPE_DCE))
 		size = 0;
-	} else {
+	else
 		size = amdgpu_gmc_get_vbios_fb_size(adev);
 
-		if (adev->mman.keep_stolen_vga_memory)
-			size = max(size, (unsigned)AMDGPU_VBIOS_VGA_ALLOCATION);
-	}
+	if (adev->mman.keep_stolen_vga_memory)
+		size = max(size, (unsigned)AMDGPU_VBIOS_VGA_ALLOCATION);
 
 	/* set to 0 if the pre-OS buffer uses up most of vram */
 	if ((adev->gmc.real_vram_size - size) < (8 * 1024 * 1024))
-- 
2.25.1

