From caa21c026ea253b5ecadf9920ba3e9f4cd241780 Mon Sep 17 00:00:00 2001
From: Ranjan Dutta <ranjan.dutta@intel.com>
Date: Wed, 10 Mar 2021 12:16:25 +0800
Subject: [PATCH 16/55] Revert "drm/amdkfd: Fix recursive lock warnings"

This reverts commit a81bb9031a75325b48abb33c4598e4e0ae768178.
---
 drivers/gpu/drm/amd/amdkfd/kfd_device_queue_manager.h | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/gpu/drm/amd/amdkfd/kfd_device_queue_manager.h b/drivers/gpu/drm/amd/amdkfd/kfd_device_queue_manager.h
index 7351dd195274..16262e5d93f5 100644
--- a/drivers/gpu/drm/amd/amdkfd/kfd_device_queue_manager.h
+++ b/drivers/gpu/drm/amd/amdkfd/kfd_device_queue_manager.h
@@ -243,11 +243,11 @@ get_sh_mem_bases_nybble_64(struct kfd_process_device *pdd)
 static inline void dqm_lock(struct device_queue_manager *dqm)
 {
 	mutex_lock(&dqm->lock_hidden);
-	dqm->saved_flags = memalloc_noreclaim_save();
+	dqm->saved_flags = memalloc_nofs_save();
 }
 static inline void dqm_unlock(struct device_queue_manager *dqm)
 {
-	memalloc_noreclaim_restore(dqm->saved_flags);
+	memalloc_nofs_restore(dqm->saved_flags);
 	mutex_unlock(&dqm->lock_hidden);
 }
 
-- 
2.25.1

