From 5266c6c61d1dc42d69116068351e440ed2808b55 Mon Sep 17 00:00:00 2001
From: Junxiao Chang <junxiao.chang@intel.com>
Date: Tue, 8 Nov 2022 09:49:16 +0800
Subject: [PATCH 2/2] serial: 8250: dma: checking dev is pci device or not

"dev" might not be pci device. In this case, it is not EHL device
and should return 0 directly.

Signed-off-by: Junxiao Chang <junxiao.chang@intel.com>
---
 drivers/tty/serial/8250/8250_dma.c | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/drivers/tty/serial/8250/8250_dma.c b/drivers/tty/serial/8250/8250_dma.c
index 24793638c7db..ecd11775c59e 100644
--- a/drivers/tty/serial/8250/8250_dma.c
+++ b/drivers/tty/serial/8250/8250_dma.c
@@ -14,7 +14,12 @@
 
 static int ehl_pse_dma_dev(struct device *dev)
 {
-	struct pci_dev *pdev = to_pci_dev(dev);
+	struct pci_dev *pdev;
+
+	if (!dev_is_pci(dev))
+		return 0;
+
+	pdev = to_pci_dev(dev);
 
 	if ((pdev->vendor == PCI_VENDOR_ID_INTEL) &&
 		(pdev->device == 0x4b96 || pdev->device == 0x4b97 ||
-- 
2.25.1

