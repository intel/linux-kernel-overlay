From b96651dd01086a82005cbe0a6e648249c599ad90 Mon Sep 17 00:00:00 2001
From: Ranjan Dutta <ranjan.dutta@intel.com>
Date: Mon, 19 Apr 2021 09:41:45 +0800
Subject: [PATCH 09/13] Revert "drm/tegra: dc: Restore coupling of display
 controllers"

This reverts commit f552f95853f88946460d6f163e43b7526d7efa70.
---
 drivers/gpu/drm/tegra/dc.c | 20 ++++++++++++--------
 1 file changed, 12 insertions(+), 8 deletions(-)

diff --git a/drivers/gpu/drm/tegra/dc.c b/drivers/gpu/drm/tegra/dc.c
index 3a244ef7f30f..b2c8c68b7e26 100644
--- a/drivers/gpu/drm/tegra/dc.c
+++ b/drivers/gpu/drm/tegra/dc.c
@@ -2499,18 +2499,22 @@ static int tegra_dc_couple(struct tegra_dc *dc)
 	 * POWER_CONTROL registers during CRTC enabling.
 	 */
 	if (dc->soc->coupled_pm && dc->pipe == 1) {
-		struct device *companion;
-		struct tegra_dc *parent;
+		u32 flags = DL_FLAG_PM_RUNTIME | DL_FLAG_AUTOREMOVE_CONSUMER;
+		struct device_link *link;
+		struct device *partner;
 
-		companion = driver_find_device(dc->dev->driver, NULL, (const void *)0,
-					       tegra_dc_match_by_pipe);
-		if (!companion)
+		partner = driver_find_device(dc->dev->driver, NULL, NULL,
+					     tegra_dc_match_by_pipe);
+		if (!partner)
 			return -EPROBE_DEFER;
 
-		parent = dev_get_drvdata(companion);
-		dc->client.parent = &parent->client;
+		link = device_link_add(dc->dev, partner, flags);
+		if (!link) {
+			dev_err(dc->dev, "failed to link controllers\n");
+			return -EINVAL;
+		}
 
-		dev_dbg(dc->dev, "coupled to %s\n", dev_name(companion));
+		dev_dbg(dc->dev, "coupled to %s\n", dev_name(partner));
 	}
 
 	return 0;
-- 
2.25.1

