From bb8df29a8148a1805dd9e39ca69b5cba1b43bb17 Mon Sep 17 00:00:00 2001
From: Alexander Usyskin <alexander.usyskin@intel.com>
Date: Sun, 27 Aug 2023 17:08:51 +0300
Subject: [PATCH 18/19] mei: me: apply GSC error supression to systems with
 force wake workaround

GSC FW on systems with force wake workaround undergoes reset in
order to move to a new state. Those resets are frequent and expected.
This commit silences the 'unexpected' warning message in such cases to
improve log readability and avoid confusion.

Signed-off-by: Alexander Usyskin <alexander.usyskin@intel.com>
Signed-off-by: Tomas Winkler <tomas.winkler@intel.com>
---
 drivers/misc/mei/hw-me.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/misc/mei/hw-me.c b/drivers/misc/mei/hw-me.c
index 7011b834c0b9..8276d9d45060 100644
--- a/drivers/misc/mei/hw-me.c
+++ b/drivers/misc/mei/hw-me.c
@@ -593,7 +593,7 @@ static void mei_me_check_fw_reset(struct mei_device *dev)
 	if (!dev->saved_fw_status_flag)
 		goto end;
 
-	if (dev->gsc_reset_to_pxp == MEI_DEV_RESET_TO_PXP_PERFORMED) {
+	if (dev->gsc_reset_to_pxp == MEI_DEV_RESET_TO_PXP_PERFORMED || dev->forcewake_needed) {
 		ret = mei_fw_status(dev, &fw_status);
 		if (!ret) {
 			fw_pm_event = fw_status.status[1] & PCI_CFG_HFS_2_PM_EVENT_MASK;
-- 
2.25.1

