From 4383773ad574e07df6184c21f26c473975f46833 Mon Sep 17 00:00:00 2001
From: Michal Wajdeczko <michal.wajdeczko@intel.com>
Date: Fri, 5 Apr 2024 15:39:35 +0200
Subject: [PATCH 0848/1274] drm/xe/vf: Don't try to program MOCS if VF

VFs drivers don't have access to MOCS registers. It is a PF driver
responsibility to program MOCS according to the HW team guidelines.

Signed-off-by: Michal Wajdeczko <michal.wajdeczko@intel.com>
Reviewed-by: Himal Prasad Ghimiray <himal.prasad.ghimiray@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20240405133936.891-3-michal.wajdeczko@intel.com
---
 drivers/gpu/drm/xe/xe_mocs.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/drivers/gpu/drm/xe/xe_mocs.c b/drivers/gpu/drm/xe/xe_mocs.c
index bff659d20062..d16fa64da881 100644
--- a/drivers/gpu/drm/xe/xe_mocs.c
+++ b/drivers/gpu/drm/xe/xe_mocs.c
@@ -568,6 +568,9 @@ void xe_mocs_init(struct xe_gt *gt)
 	flags = get_mocs_settings(gt_to_xe(gt), &table);
 	mocs_dbg(gt, "flag:0x%x\n", flags);
 
+	if (IS_SRIOV_VF(gt_to_xe(gt)))
+		return;
+
 	if (flags & HAS_GLOBAL_MOCS)
 		__init_mocs_table(gt, &table);
 	if (flags & HAS_LNCF_MOCS)
-- 
2.25.1

