From cac51ae2946373073cf6ce5da57d44f1f4f95478 Mon Sep 17 00:00:00 2001
From: Ranjan Dutta <ranjan.dutta@intel.com>
Date: Tue, 7 Dec 2021 01:21:01 +0800
Subject: [PATCH 17/33] Revert "drm/msm: Fix potential NULL dereference in DPU
 SSPP"

This reverts commit 807f01f60cd0a9b0c3154d7b635b02b8002d3c9f.
---
 drivers/gpu/drm/msm/disp/dpu1/dpu_hw_sspp.c | 8 +++-----
 1 file changed, 3 insertions(+), 5 deletions(-)

diff --git a/drivers/gpu/drm/msm/disp/dpu1/dpu_hw_sspp.c b/drivers/gpu/drm/msm/disp/dpu1/dpu_hw_sspp.c
index 016c462bdb5d..c940b69435e1 100644
--- a/drivers/gpu/drm/msm/disp/dpu1/dpu_hw_sspp.c
+++ b/drivers/gpu/drm/msm/disp/dpu1/dpu_hw_sspp.c
@@ -138,13 +138,11 @@ static int _sspp_subblk_offset(struct dpu_hw_pipe *ctx,
 		u32 *idx)
 {
 	int rc = 0;
-	const struct dpu_sspp_sub_blks *sblk;
+	const struct dpu_sspp_sub_blks *sblk = ctx->cap->sblk;
 
-	if (!ctx || !ctx->cap || !ctx->cap->sblk)
+	if (!ctx)
 		return -EINVAL;
 
-	sblk = ctx->cap->sblk;
-
 	switch (s_id) {
 	case DPU_SSPP_SRC:
 		*idx = sblk->src_blk.base;
@@ -421,7 +419,7 @@ static void _dpu_hw_sspp_setup_scaler3(struct dpu_hw_pipe *ctx,
 
 	(void)pe;
 	if (_sspp_subblk_offset(ctx, DPU_SSPP_SCALER_QSEED3, &idx) || !sspp
-		|| !scaler3_cfg)
+		|| !scaler3_cfg || !ctx || !ctx->cap || !ctx->cap->sblk)
 		return;
 
 	dpu_hw_setup_scaler3(&ctx->hw, scaler3_cfg, idx,
-- 
2.27.0

