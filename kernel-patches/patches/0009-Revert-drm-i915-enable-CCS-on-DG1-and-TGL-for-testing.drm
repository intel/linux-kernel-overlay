From be101f544f63986169cce92453c57b1dcf32006b Mon Sep 17 00:00:00 2001
From: Junxiao Chang <junxiao.chang@intel.com>
Date: Mon, 28 Nov 2022 13:11:37 +0800
Subject: [PATCH 0009/2779] Revert "drm/i915: enable CCS on DG1 and TGL for
 testing"

This reverts commit a8310ec3bca90b38bd9911e81716caed00b91519.
---
 drivers/gpu/drm/i915/gt/intel_lrc.c |  3 +--
 drivers/gpu/drm/i915/i915_driver.c  | 15 ---------------
 2 files changed, 1 insertion(+), 17 deletions(-)

diff --git a/drivers/gpu/drm/i915/gt/intel_lrc.c b/drivers/gpu/drm/i915/gt/intel_lrc.c
index da7ea7b9625b..eec73c66406c 100644
--- a/drivers/gpu/drm/i915/gt/intel_lrc.c
+++ b/drivers/gpu/drm/i915/gt/intel_lrc.c
@@ -717,8 +717,7 @@ static int lrc_ring_cmd_buf_cctl(const struct intel_engine_cs *engine)
 		 * simply to match the RCS context image layout.
 		 */
 		return 0xc6;
-	else if (engine->class != RENDER_CLASS &&
-		 engine->class != COMPUTE_CLASS)
+	else if (engine->class != RENDER_CLASS)
 		return -1;
 	else if (GRAPHICS_VER(engine->i915) >= 12)
 		return 0xb6;
diff --git a/drivers/gpu/drm/i915/i915_driver.c b/drivers/gpu/drm/i915/i915_driver.c
index 25ac71a2088f..d6825f19fa41 100644
--- a/drivers/gpu/drm/i915/i915_driver.c
+++ b/drivers/gpu/drm/i915/i915_driver.c
@@ -878,21 +878,6 @@ int i915_driver_probe(struct pci_dev *pdev, const struct pci_device_id *ent)
 	if (IS_ERR(i915))
 		return PTR_ERR(i915);
 
-	/*
-	 * Hack to enable CCS and set ppgtt_size to 47
-	 * on TGL and DG1 for testing purpose
-	 *
-	 */
-	if ((match_info->platform == INTEL_DG1 ||
-	    match_info->platform == INTEL_TIGERLAKE ||
-		match_info->platform == INTEL_ALDERLAKE_S ||
-		match_info->platform == INTEL_ALDERLAKE_P) &&
-	    (i915->params.enable_guc & ENABLE_GUC_SUBMISSION)
-	    && i915->params.enable_guc != -1) {
-		mkwrite_device_info(i915)->ppgtt_size = 47;
-		mkwrite_device_info(i915)->platform_engine_mask |= BIT(CCS0);
-	}
-
 	/* Disable nuclear pageflip by default on pre-ILK */
 	if (!i915->params.nuclear_pageflip && match_info->graphics.ver < 5)
 		i915->drm.driver_features &= ~DRIVER_ATOMIC;
-- 
2.25.1

