From 240ae6dbd64f8db5bbacb91b3f02170c460099ed Mon Sep 17 00:00:00 2001
From: Junxiao Chang <junxiao.chang@intel.com>
Date: Thu, 6 Jul 2023 15:04:16 +0800
Subject: [PATCH 0070/2351] Revert "lib/ref_tracker: remove warnings in case of
 allocation failure"

This reverts commit 02706d0247443d3145b3df829e7de27f122a28dd.
---
 lib/ref_tracker.c | 5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

diff --git a/lib/ref_tracker.c b/lib/ref_tracker.c
index cae4498fcfd70..2ef4596b6b36f 100644
--- a/lib/ref_tracker.c
+++ b/lib/ref_tracker.c
@@ -189,7 +189,7 @@ int ref_tracker_alloc(struct ref_tracker_dir *dir,
 	unsigned long entries[REF_TRACKER_STACK_ENTRIES];
 	struct ref_tracker *tracker;
 	unsigned int nr_entries;
-	gfp_t gfp_mask = gfp | __GFP_NOWARN;
+	gfp_t gfp_mask = gfp;
 	unsigned long flags;
 
 	WARN_ON_ONCE(dir->dead);
@@ -237,8 +237,7 @@ int ref_tracker_free(struct ref_tracker_dir *dir,
 		return -EEXIST;
 	}
 	nr_entries = stack_trace_save(entries, ARRAY_SIZE(entries), 1);
-	stack_handle = stack_depot_save(entries, nr_entries,
-					GFP_NOWAIT | __GFP_NOWARN);
+	stack_handle = stack_depot_save(entries, nr_entries, GFP_ATOMIC);
 
 	spin_lock_irqsave(&dir->lock, flags);
 	if (tracker->dead) {
-- 
2.25.1

