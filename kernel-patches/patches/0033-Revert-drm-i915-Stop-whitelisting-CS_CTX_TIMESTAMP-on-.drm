From 2edc490d6df2da6e4d4012e0a6cc809164061738 Mon Sep 17 00:00:00 2001
From: Junxiao Chang <junxiao.chang@intel.com>
Date: Thu, 6 Jul 2023 15:01:18 +0800
Subject: [PATCH 0033/2351] Revert "drm/i915: Stop whitelisting
 CS_CTX_TIMESTAMP on Xe_HP platforms"

This reverts commit fbe26dbd81b22e215981babd1f393d0d912151be.
---
 drivers/gpu/drm/i915/gt/intel_workarounds.c | 11 ++++++++++-
 1 file changed, 10 insertions(+), 1 deletion(-)

diff --git a/drivers/gpu/drm/i915/gt/intel_workarounds.c b/drivers/gpu/drm/i915/gt/intel_workarounds.c
index a6e6c906dba26..5273029b94a7a 100644
--- a/drivers/gpu/drm/i915/gt/intel_workarounds.c
+++ b/drivers/gpu/drm/i915/gt/intel_workarounds.c
@@ -2167,10 +2167,17 @@ static void tgl_whitelist_build(struct intel_engine_cs *engine)
 	}
 }
 
+static void xehpsdv_whitelist_build(struct intel_engine_cs *engine)
+{
+	allow_read_ctx_timestamp(engine);
+}
+
 static void dg2_whitelist_build(struct intel_engine_cs *engine)
 {
 	struct i915_wa_list *w = &engine->whitelist;
 
+	allow_read_ctx_timestamp(engine);
+
 	switch (engine->class) {
 	case RENDER_CLASS:
 		/*
@@ -2221,6 +2228,8 @@ static void blacklist_trtt(struct intel_engine_cs *engine)
 
 static void pvc_whitelist_build(struct intel_engine_cs *engine)
 {
+	allow_read_ctx_timestamp(engine);
+
 	/* Wa_16014440446:pvc */
 	blacklist_trtt(engine);
 }
@@ -2258,7 +2267,7 @@ void intel_engine_init_whitelist(struct intel_engine_cs *engine)
 	else if (IS_DG2(i915))
 		dg2_whitelist_build(engine);
 	else if (IS_XEHPSDV(i915))
-		; /* none needed */
+		xehpsdv_whitelist_build(engine);
 	else if (GRAPHICS_VER(i915) == 12)
 		tgl_whitelist_build(engine);
 	else if (GRAPHICS_VER(i915) == 11)
-- 
2.25.1

