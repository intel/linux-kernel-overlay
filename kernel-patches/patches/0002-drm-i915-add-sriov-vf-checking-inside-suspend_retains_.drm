From 35455cde96a7df701a8dbc930c250939f7f4b689 Mon Sep 17 00:00:00 2001
From: "Abdul Halim, Mohd Syazwan" <mohd.syazwan.abdul.halim@intel.com>
Date: Thu, 22 Dec 2022 04:19:37 +0800
Subject: [PATCH 2/2] drm/i915: add sriov-vf checking inside
 suspend_retains_ptes

add sriov-vf checking inside suspend_retains_ptes, so it will not
use last pte for vf during vf suspend/resume due to guc init issues
when it resumes

Signed-off-by: Abdul Halim, Mohd Syazwan <mohd.syazwan.abdul.halim@intel.com>
---
 drivers/gpu/drm/i915/gt/intel_ggtt.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/gpu/drm/i915/gt/intel_ggtt.c b/drivers/gpu/drm/i915/gt/intel_ggtt.c
index c0e8adc8cbc1..5b9136d5bf76 100644
--- a/drivers/gpu/drm/i915/gt/intel_ggtt.c
+++ b/drivers/gpu/drm/i915/gt/intel_ggtt.c
@@ -30,7 +30,7 @@
 static inline bool suspend_retains_ptes(struct i915_address_space *vm)
 {
 	return GRAPHICS_VER(vm->i915) >= 8 &&
-		!HAS_LMEM(vm->i915) &&
+		!HAS_LMEM(vm->i915) && !IS_SRIOV_VF(vm->i915) &&
 		vm->is_ggtt;
 }
 
-- 
2.25.1

