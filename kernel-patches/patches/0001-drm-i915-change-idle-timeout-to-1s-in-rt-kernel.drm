From cc5e48b1ecd818f6b0de961d52f2d3afd531e8b5 Mon Sep 17 00:00:00 2001
From: Junxiao Chang <junxiao.chang@intel.com>
Date: Mon, 28 Jun 2021 17:55:43 +0800
Subject: [PATCH 1/4] drm/i915: change idle timeout to 1s in rt kernel

In preempt rt kernel, it might timeout if idle timeout is 200ms.
gt is set to "wedged" state, some drm features might be disabled.
Change idle timeout to 1s if preempt rt is enabled.

Signed-off-by: Junxiao Chang <junxiao.chang@intel.com>
---
 drivers/gpu/drm/i915/i915_gem.h | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/drivers/gpu/drm/i915/i915_gem.h b/drivers/gpu/drm/i915/i915_gem.h
index 702aface1c353..1be549c6e00be 100644
--- a/drivers/gpu/drm/i915/i915_gem.h
+++ b/drivers/gpu/drm/i915/i915_gem.h
@@ -89,7 +89,11 @@ struct drm_i915_private;
 #define GEM_TRACE_DUMP_ON(expr) BUILD_BUG_ON_INVALID(expr)
 #endif
 
+#ifdef CONFIG_PREEMPT_RT
+#define I915_GEM_IDLE_TIMEOUT HZ
+#else
 #define I915_GEM_IDLE_TIMEOUT (HZ / 5)
+#endif
 
 static inline void tasklet_lock(struct tasklet_struct *t)
 {
-- 
2.27.0

