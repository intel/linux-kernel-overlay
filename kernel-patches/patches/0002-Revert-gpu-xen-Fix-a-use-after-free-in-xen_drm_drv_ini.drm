From 20f223bc6011a8518a45587d88eb363c1330b3dd Mon Sep 17 00:00:00 2001
From: Ranjan Dutta <ranjan.dutta@intel.com>
Date: Thu, 22 Apr 2021 13:14:06 +0800
Subject: [PATCH 2/4] Revert "gpu/xen: Fix a use after free in
 xen_drm_drv_init"

This reverts commit 7a1cd9044da449f389b9a8b45da7f3c0eff77757.
---
 drivers/gpu/drm/xen/xen_drm_front.c | 6 ++----
 1 file changed, 2 insertions(+), 4 deletions(-)

diff --git a/drivers/gpu/drm/xen/xen_drm_front.c b/drivers/gpu/drm/xen/xen_drm_front.c
index 8ea91542b567..cc93a8c9547b 100644
--- a/drivers/gpu/drm/xen/xen_drm_front.c
+++ b/drivers/gpu/drm/xen/xen_drm_front.c
@@ -531,7 +531,7 @@ static int xen_drm_drv_init(struct xen_drm_front_info *front_info)
 	drm_dev = drm_dev_alloc(&xen_drm_driver, dev);
 	if (IS_ERR(drm_dev)) {
 		ret = PTR_ERR(drm_dev);
-		goto fail_dev;
+		goto fail;
 	}
 
 	drm_info->drm_dev = drm_dev;
@@ -561,10 +561,8 @@ static int xen_drm_drv_init(struct xen_drm_front_info *front_info)
 	drm_kms_helper_poll_fini(drm_dev);
 	drm_mode_config_cleanup(drm_dev);
 	drm_dev_put(drm_dev);
-fail_dev:
-	kfree(drm_info);
-	front_info->drm_info = NULL;
 fail:
+	kfree(drm_info);
 	return ret;
 }
 
-- 
2.25.1

