From 98a619887c804bd2ab4376f0072f07b0dfcdbb34 Mon Sep 17 00:00:00 2001
From: Ranjan Dutta <ranjan.dutta@intel.com>
Date: Mon, 4 Apr 2022 01:55:33 +0800
Subject: [PATCH 04/18] Revert "drm/amdgpu: check vm ready by
 amdgpu_vm->evicting flag"

This reverts commit 4a9d2390f3e2d128b1a73279d16bb1176207a0e2.
---
 drivers/gpu/drm/amd/amdgpu/amdgpu_vm.c | 9 ++-------
 1 file changed, 2 insertions(+), 7 deletions(-)

diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu_vm.c b/drivers/gpu/drm/amd/amdgpu/amdgpu_vm.c
index 47cc038d7d50..b47829ff30af 100644
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_vm.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_vm.c
@@ -715,16 +715,11 @@ int amdgpu_vm_validate_pt_bos(struct amdgpu_device *adev, struct amdgpu_vm *vm,
  * Check if all VM PDs/PTs are ready for updates
  *
  * Returns:
- * True if VM is not evicting.
+ * True if eviction list is empty.
  */
 bool amdgpu_vm_ready(struct amdgpu_vm *vm)
 {
-	bool ret;
-
-	amdgpu_vm_eviction_lock(vm);
-	ret = !vm->evicting;
-	amdgpu_vm_eviction_unlock(vm);
-	return ret;
+	return list_empty(&vm->evicted);
 }
 
 /**
-- 
2.27.0

