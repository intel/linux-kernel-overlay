From 606d4e575a3e0f673db94118cff4d259965f8beb Mon Sep 17 00:00:00 2001
From: Junxiao Chang <junxiao.chang@intel.com>
Date: Thu, 6 Jul 2023 15:01:18 +0800
Subject: [PATCH 0038/2351] Revert "drm/i915: enable CCS on DG1 and TGL for
 testing"

This reverts commit b86dffb4de53f86a7218ab4ffb83b516d2461b92.
---
 drivers/gpu/drm/i915/gt/intel_lrc.c |  3 +--
 drivers/gpu/drm/i915/i915_driver.c  | 17 -----------------
 2 files changed, 1 insertion(+), 19 deletions(-)

diff --git a/drivers/gpu/drm/i915/gt/intel_lrc.c b/drivers/gpu/drm/i915/gt/intel_lrc.c
index d5f2f70230712..080b75b19b67a 100644
--- a/drivers/gpu/drm/i915/gt/intel_lrc.c
+++ b/drivers/gpu/drm/i915/gt/intel_lrc.c
@@ -802,8 +802,7 @@ static int lrc_ring_cmd_buf_cctl(const struct intel_engine_cs *engine)
 		 * simply to match the RCS context image layout.
 		 */
 		return 0xc6;
-	else if (engine->class != RENDER_CLASS &&
-		 engine->class != COMPUTE_CLASS)
+	else if (engine->class != RENDER_CLASS)
 		return -1;
 	else if (GRAPHICS_VER(engine->i915) >= 12)
 		return 0xb6;
diff --git a/drivers/gpu/drm/i915/i915_driver.c b/drivers/gpu/drm/i915/i915_driver.c
index 68cbeec557330..caed6658fffb0 100644
--- a/drivers/gpu/drm/i915/i915_driver.c
+++ b/drivers/gpu/drm/i915/i915_driver.c
@@ -789,8 +789,6 @@ static void i915_virtualization_probe(struct drm_i915_private *i915)
  */
 int i915_driver_probe(struct pci_dev *pdev, const struct pci_device_id *ent)
 {
-	const struct intel_device_info *match_info =
-		(struct intel_device_info *)ent->driver_data;
 	struct drm_i915_private *i915;
 	int ret;
 
@@ -798,21 +796,6 @@ int i915_driver_probe(struct pci_dev *pdev, const struct pci_device_id *ent)
 	if (IS_ERR(i915))
 		return PTR_ERR(i915);
 
-	/*
-	 * Hack to enable CCS and set ppgtt_size to 47
-	 * on TGL and DG1 for testing purpose
-	 *
-	 */
-	if ((match_info->platform == INTEL_DG1 ||
-	    match_info->platform == INTEL_TIGERLAKE ||
-		match_info->platform == INTEL_ALDERLAKE_S ||
-		match_info->platform == INTEL_ALDERLAKE_P) &&
-	    (i915->params.enable_guc & ENABLE_GUC_SUBMISSION)
-	    && i915->params.enable_guc != -1) {
-		RUNTIME_INFO(i915)->ppgtt_size = 47;
-		RUNTIME_INFO(i915)->platform_engine_mask |= BIT(CCS0);
-	}
-
 	ret = pci_enable_device(pdev);
 	if (ret)
 		goto out_fini;
-- 
2.25.1

