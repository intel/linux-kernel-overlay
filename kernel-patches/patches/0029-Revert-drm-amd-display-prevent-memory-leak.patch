From 0d2abc11acb0fc8a7bb878ad93b7e22a3cfd7d4b Mon Sep 17 00:00:00 2001
From: Ranjan Dutta <ranjan.dutta@intel.com>
Date: Mon, 6 Feb 2023 10:14:28 +0800
Subject: [PATCH 29/45] Revert "drm/amd/display: prevent memory leak"

This reverts commit 648cdb8bf376e722169a681489820b747eda8415.
---
 drivers/gpu/drm/amd/display/dc/dce60/dce60_resource.c | 3 ---
 drivers/gpu/drm/amd/display/dc/dce80/dce80_resource.c | 2 --
 2 files changed, 5 deletions(-)

diff --git a/drivers/gpu/drm/amd/display/dc/dce60/dce60_resource.c b/drivers/gpu/drm/amd/display/dc/dce60/dce60_resource.c
index bcdd8a958fc01..5a5a9cb77acbf 100644
--- a/drivers/gpu/drm/amd/display/dc/dce60/dce60_resource.c
+++ b/drivers/gpu/drm/amd/display/dc/dce60/dce60_resource.c
@@ -1132,7 +1132,6 @@ struct resource_pool *dce60_create_resource_pool(
 	if (dce60_construct(num_virtual_links, dc, pool))
 		return &pool->base;
 
-	kfree(pool);
 	BREAK_TO_DEBUGGER();
 	return NULL;
 }
@@ -1330,7 +1329,6 @@ struct resource_pool *dce61_create_resource_pool(
 	if (dce61_construct(num_virtual_links, dc, pool))
 		return &pool->base;
 
-	kfree(pool);
 	BREAK_TO_DEBUGGER();
 	return NULL;
 }
@@ -1524,7 +1522,6 @@ struct resource_pool *dce64_create_resource_pool(
 	if (dce64_construct(num_virtual_links, dc, pool))
 		return &pool->base;
 
-	kfree(pool);
 	BREAK_TO_DEBUGGER();
 	return NULL;
 }
diff --git a/drivers/gpu/drm/amd/display/dc/dce80/dce80_resource.c b/drivers/gpu/drm/amd/display/dc/dce80/dce80_resource.c
index 2eefa07762ae1..a19be9de2df7d 100644
--- a/drivers/gpu/drm/amd/display/dc/dce80/dce80_resource.c
+++ b/drivers/gpu/drm/amd/display/dc/dce80/dce80_resource.c
@@ -1141,7 +1141,6 @@ struct resource_pool *dce80_create_resource_pool(
 	if (dce80_construct(num_virtual_links, dc, pool))
 		return &pool->base;
 
-	kfree(pool);
 	BREAK_TO_DEBUGGER();
 	return NULL;
 }
@@ -1339,7 +1338,6 @@ struct resource_pool *dce81_create_resource_pool(
 	if (dce81_construct(num_virtual_links, dc, pool))
 		return &pool->base;
 
-	kfree(pool);
 	BREAK_TO_DEBUGGER();
 	return NULL;
 }
-- 
2.25.1

