From 51e9ee7d82e69083e2ab7ccac8277d4033c64bfd Mon Sep 17 00:00:00 2001
From: Ranjan Dutta <ranjan.dutta@intel.com>
Date: Mon, 7 Jun 2021 19:08:36 +0800
Subject: [PATCH 41/78] Revert "drm/panfrost: Don't try to map pages that are
 already mapped"

This reverts commit 09b031b5fc18f28783e0cee5cf93e7831179aa0f.
---
 drivers/gpu/drm/panfrost/panfrost_mmu.c | 9 +--------
 1 file changed, 1 insertion(+), 8 deletions(-)

diff --git a/drivers/gpu/drm/panfrost/panfrost_mmu.c b/drivers/gpu/drm/panfrost/panfrost_mmu.c
index 198686216317..e5f7f647430f 100644
--- a/drivers/gpu/drm/panfrost/panfrost_mmu.c
+++ b/drivers/gpu/drm/panfrost/panfrost_mmu.c
@@ -495,14 +495,8 @@ static int panfrost_mmu_map_fault_addr(struct panfrost_device *pfdev, int as,
 		}
 		bo->base.pages = pages;
 		bo->base.pages_use_count = 1;
-	} else {
+	} else
 		pages = bo->base.pages;
-		if (pages[page_offset]) {
-			/* Pages are already mapped, bail out. */
-			mutex_unlock(&bo->base.pages_lock);
-			goto out;
-		}
-	}
 
 	mapping = bo->base.base.filp->f_mapping;
 	mapping_set_unevictable(mapping);
@@ -535,7 +529,6 @@ static int panfrost_mmu_map_fault_addr(struct panfrost_device *pfdev, int as,
 
 	dev_dbg(pfdev->dev, "mapped page fault @ AS%d %llx", as, addr);
 
-out:
 	panfrost_gem_mapping_put(bomapping);
 
 	return 0;
-- 
2.25.1

