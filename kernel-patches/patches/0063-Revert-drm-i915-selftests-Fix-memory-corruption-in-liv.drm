From 51eb65f42cae703d8ff89db82a27249b7ca85443 Mon Sep 17 00:00:00 2001
From: Junxiao Chang <junxiao.chang@intel.com>
Date: Wed, 24 Nov 2021 13:16:42 +0800
Subject: [PATCH 063/888] Revert "drm/i915/selftests: Fix memory corruption in
 live_lrc_isolation"

This reverts commit 113faf3bd311a2322185daf31c1ff915f0daf511.
---
 drivers/gpu/drm/i915/gt/selftest_lrc.c | 29 +-------------------------
 1 file changed, 1 insertion(+), 28 deletions(-)

diff --git a/drivers/gpu/drm/i915/gt/selftest_lrc.c b/drivers/gpu/drm/i915/gt/selftest_lrc.c
index cdc6ae48a1e1..b0977a3b699b 100644
--- a/drivers/gpu/drm/i915/gt/selftest_lrc.c
+++ b/drivers/gpu/drm/i915/gt/selftest_lrc.c
@@ -1074,32 +1074,6 @@ record_registers(struct intel_context *ce,
 	goto err_after;
 }
 
-static u32 safe_offset(u32 offset, u32 reg)
-{
-	/* XXX skip testing of watchdog - VLK-22772 */
-	if (offset == 0x178 || offset == 0x17c)
-		reg = 0;
-
-	return reg;
-}
-
-static int get_offset_mask(struct intel_engine_cs *engine)
-{
-	if (GRAPHICS_VER(engine->i915) < 12)
-		return 0xfff;
-
-	switch (engine->class) {
-	default:
-	case RENDER_CLASS:
-		return 0x07ff;
-	case COPY_ENGINE_CLASS:
-		return 0x0fff;
-	case VIDEO_DECODE_CLASS:
-	case VIDEO_ENHANCEMENT_CLASS:
-		return 0x3fff;
-	}
-}
-
 static struct i915_vma *load_context(struct intel_context *ce, u32 poison)
 {
 	struct i915_vma *batch;
@@ -1143,8 +1117,7 @@ static struct i915_vma *load_context(struct intel_context *ce, u32 poison)
 		len = (len + 1) / 2;
 		*cs++ = MI_LOAD_REGISTER_IMM(len);
 		while (len--) {
-			*cs++ = safe_offset(hw[dw] & get_offset_mask(ce->engine),
-					    hw[dw]);
+			*cs++ = hw[dw];
 			*cs++ = poison;
 			dw += 2;
 		}
-- 
2.25.1

