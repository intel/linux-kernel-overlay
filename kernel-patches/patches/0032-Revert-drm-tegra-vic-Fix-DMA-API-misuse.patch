From 8d61bd89187fb573d56f2edccf9ccb44d4685446 Mon Sep 17 00:00:00 2001
From: Ranjan Dutta <ranjan.dutta@intel.com>
Date: Wed, 16 Feb 2022 00:20:16 +0800
Subject: [PATCH 32/50] Revert "drm/tegra: vic: Fix DMA API misuse"

This reverts commit 3849ec830bf714d57d08a0efd1e1125b023ee4e7.
---
 drivers/gpu/drm/tegra/vic.c | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/drivers/gpu/drm/tegra/vic.c b/drivers/gpu/drm/tegra/vic.c
index ec0e4d8f0aad..b77f726303d8 100644
--- a/drivers/gpu/drm/tegra/vic.c
+++ b/drivers/gpu/drm/tegra/vic.c
@@ -5,7 +5,6 @@
 
 #include <linux/clk.h>
 #include <linux/delay.h>
-#include <linux/dma-mapping.h>
 #include <linux/host1x.h>
 #include <linux/iommu.h>
 #include <linux/module.h>
@@ -266,8 +265,10 @@ static int vic_load_firmware(struct vic *vic)
 
 	if (!client->group) {
 		virt = dma_alloc_coherent(vic->dev, size, &iova, GFP_KERNEL);
-		if (!virt)
-			return -ENOMEM;
+
+		err = dma_mapping_error(vic->dev, iova);
+		if (err < 0)
+			return err;
 	} else {
 		virt = tegra_drm_alloc(tegra, size, &iova);
 	}
-- 
2.27.0

