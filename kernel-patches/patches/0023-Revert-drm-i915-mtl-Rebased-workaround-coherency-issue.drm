From f2b912bfa1b95ca8c34b6c5d103c7fd0d38d0b1c Mon Sep 17 00:00:00 2001
From: Junxiao Chang <junxiao.chang@intel.com>
Date: Thu, 6 Jul 2023 15:01:16 +0800
Subject: [PATCH 0023/2351] Revert "drm/i915/mtl: Rebased workaround coherency
 issue for Media"

This reverts commit 9946f71ded707584e38c63b6da821b0d27860e1f.
---
 drivers/gpu/drm/i915/gt/uc/intel_guc_ct.c | 12 ++++++------
 1 file changed, 6 insertions(+), 6 deletions(-)

diff --git a/drivers/gpu/drm/i915/gt/uc/intel_guc_ct.c b/drivers/gpu/drm/i915/gt/uc/intel_guc_ct.c
index f5a29a9cb2f3f..872321fa71b55 100644
--- a/drivers/gpu/drm/i915/gt/uc/intel_guc_ct.c
+++ b/drivers/gpu/drm/i915/gt/uc/intel_guc_ct.c
@@ -459,6 +459,12 @@ static int ct_write(struct intel_guc_ct *ct,
 	}
 	GEM_BUG_ON(tail > size);
 
+	/*
+	 * make sure H2G buffer update and LRC tail update (if this triggering a
+	 * submission) are visible before updating the descriptor tail
+	 */
+	intel_guc_write_barrier(ct_to_guc(ct));
+
 	/* update local copies */
 	ctb->tail = tail;
 	GEM_BUG_ON(atomic_read(&ctb->space) < len + GUC_CTB_HDR_LEN);
@@ -487,12 +493,6 @@ static int ct_write(struct intel_guc_ct *ct,
 	 */
 	/* intel_guc_write_barrier(ct_to_guc(ct)); */
 
-	/*
-	 * make sure H2G buffer update and LRC tail update (if this triggering a
-	 * submission) are visible before updating the descriptor tail
-	 */
-	intel_guc_write_barrier(ct_to_guc(ct));
-
 	return 0;
 
 corrupted:
-- 
2.25.1

