From 124a1344be354a5b670cdefbc8a3560c612663ea Mon Sep 17 00:00:00 2001
From: Ben Skeggs <bskeggs@redhat.com>
Date: Wed, 1 Jun 2022 20:48:19 +1000
Subject: [PATCH 0783/2236] drm/nouveau/gr/gv100-: move init_419bd8() after
 sw_ctx load

Match RM.

Signed-off-by: Ben Skeggs <bskeggs@redhat.com>
Reviewed-by: Lyude Paul <lyude@redhat.com>
---
 drivers/gpu/drm/nouveau/nvkm/engine/gr/ctxgf100.c | 3 +++
 drivers/gpu/drm/nouveau/nvkm/engine/gr/gf100.c    | 3 ---
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/gpu/drm/nouveau/nvkm/engine/gr/ctxgf100.c b/drivers/gpu/drm/nouveau/nvkm/engine/gr/ctxgf100.c
index a56f4f3f6c1e..7c318cdcb428 100644
--- a/drivers/gpu/drm/nouveau/nvkm/engine/gr/ctxgf100.c
+++ b/drivers/gpu/drm/nouveau/nvkm/engine/gr/ctxgf100.c
@@ -1359,6 +1359,9 @@ gf100_grctx_generate_main(struct gf100_gr_chan *chan)
 		gf100_gr_mmio(gr, gr->sw_ctx);
 	}
 
+	if (gr->func->init_419bd8)
+		gr->func->init_419bd8(gr);
+
 	gf100_gr_wait_idle(gr);
 
 	idle_timeout = nvkm_mask(device, 0x404154, 0xffffffff, 0x00000000);
diff --git a/drivers/gpu/drm/nouveau/nvkm/engine/gr/gf100.c b/drivers/gpu/drm/nouveau/nvkm/engine/gr/gf100.c
index 5ce83b915ebb..ddf06f5e7535 100644
--- a/drivers/gpu/drm/nouveau/nvkm/engine/gr/gf100.c
+++ b/drivers/gpu/drm/nouveau/nvkm/engine/gr/gf100.c
@@ -2333,9 +2333,6 @@ gf100_gr_init(struct gf100_gr *gr)
 
 	nvkm_mask(device, 0x400500, 0x00010001, 0x00000000);
 
-	if (gr->func->init_419bd8)
-		gr->func->init_419bd8(gr);
-
 	gr->func->init_gpc_mmu(gr);
 
 	if (gr->sw_nonctx)
-- 
2.25.1

